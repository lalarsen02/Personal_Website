<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Louis Larsen</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- For 32x32 and 16x16 icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">

    <!-- For Apple Touch Devices -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
      .portfolio-logo {
        height: 44px;
        vertical-align: middle;
      }

      .portfolio-navbar {
        padding: 16px 0;
        background-color: #ffffff;
        border-bottom: 1px solid #ebebeb;
      }

      .navbar-menu.is-active .link {
        display: inline-flex;
        flex-direction: row;
        gap: 0.5rem;
      }

      .main-hero {
        padding-top: 32px;
        background-color: #1d3651;
      }

      .main-hero h1 {
        margin-top: 120px;
        font-size: 60px;
        font-weight: 800;
        line-height: 64px;
        color: white;
      }

      .main-hero h2 {
        margin-bottom: 24px;
        font-size: 30px;
        font-weight: 800;
        line-height: 32px;
        color: white;
      }

      .head-navbar-item {
        color: #0d1b2a;
        font-size: 1.1rem;
      }

      p.body1 {
        font-size: 20px;
        font-weight: 400;
        line-height: 28px;
        margin-right: 100px;
        color: white;
      }

      p.body2 {
        font-size: 20px;
        font-weight: 400;
        line-height: 28px;
      }

      .styled-image {
        border-radius: 15px;
        box-shadow: 10px 10px 10px rgba(0, 0, 0, 0.5);
      }

      .footer {
        background-color: #142236;
      }

      .hero-button {
        background-color: #fed523;
        border-color: #ddb71d;
        box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.2);
      }

      .portfolio-navbar-footer {
        background-color: #142236;
      }

      .portfolio-footer {
        background-color: #142236;
      }

      .footer-navbar-item {
        color: #d8d8d8;
        font-size: 1.1rem;
      }

      .contact h2 {
        margin-bottom: 16px;
        font-size: 40px;
        font-weight: 800;
        line-height: 45px;
        color: #202020
      }
/* 
      .contact-button {
        color: #202020;
        background-color: #fed523;
        border-color: #ddb71d;
        box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.2);
      } */

      @media screen and (max-width: 1215px) {
        .main-hero h1 {
          margin-top: 60px;
        }
      }

      @media screen and (max-width: 1023px) {
        .main-hero {
          padding-top: 0px;
        }

        .portfolio-menu {
          padding: 1.5em;
          border-radius: 1em;
          box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.2);
          border-color: #b3b3b3;
          border-style: solid;
          border-width: 1px;
          position: absolute;
          right: 2rem;
          top: 4.5rem;
          transform-origin: right top;
          z-index: 5;
        }

        .portfolio-navbar {
          padding: 0 0;
        }

        .main-hero h1 {
          margin-top: 0px;
        }

        .portfolio-footer {
          box-shadow: none;
          justify-content: center;
          align-items: center;
        }
      }

      @media screen and (max-width: 768px) {
        h1, h2, p.body1 {
          margin: 0; /* Optional: Remove any default margins */
        }
      }
    </style>
  </head>
  <body class="has-navbar-fixed-top">
    {% include 'header.html' %}
    <section class="main-hero hero">
      <div class="hero-body">
        <div class="container">
          <div class="columns">
            <div class="column is-three-fifths">
              <h1>Louis Larsen</h1>
              <h2>Software Engineer</h2>
              <p class="body1">
                Iâ€™m a recent graduate of Princeton University who majored in computer science and minored in music performance and composition. With these two different worlds, I merge creativity with technical expertise to develop cutting-edge applications.
              </p>
              <p>
                <br>
                <a class="button hero-button">
                  See My Work
                </a>
              </p>
            </div>
            <div class="column">
              <img class="is-fullwidth styled-image" src="{{ url_for('static', filename='Portrait_full.png') }}">
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="section contact">
      <div class="container">
        <div class="columns">
          <div class="column is-two-fifths">
            <h2>Let's Connect</h2>
            <p class="body2">
              Thank you for visiting my web portfolio. If you have any questions regarding the projects showcased here or are interested in collaborating, feel free to send me an email! Let's work together and bring ideas to life!
            </p>
          </div>
          <div class="column">
            <div class="field">
              <label class="label">Name</label>
              <div class="control">
                <input class="input" type="text" placeholder="Name">
              </div>
            </div>
            <div class="field">
              <label class="label">Email</label>
              <div class="control has-icons-right">
                <input class="input" type="text" placeholder="Email">
              </div>
            </div>
            <div class="field">
              <label class="label">Message</label>
              <div class="control">
                <textarea class="textarea" placeholder="Message"></textarea>
              </div>
            </div>
            <div class="field">
              <div class="control">
                <button class="button is-link">Send</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    {% include 'footer.html' %}
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Select the email input element and its parent field
    const emailInput = document.querySelector("input[placeholder='Email']");
    const emailControl = emailInput.closest(".control");
    const emailField = emailInput.closest(".field");

    // Function to validate an email using regex
    const isValidEmail = (email) => {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    };

    // Add event listener for input event
    emailInput.addEventListener("input", () => {
      // Remove any existing status spans
      const existingIcon = emailControl.querySelector(".icon");
      if (existingIcon) existingIcon.remove();
      const existingHelp = emailField.querySelector(".help");
      if (existingHelp) existingHelp.remove();

      // Remove any existing classes
      emailInput.classList.remove("is-danger", "is-success");

      // Validate the email and add appropriate class and icon
      const iconSpan = document.createElement("span");
      iconSpan.classList.add("icon", "is-small", "is-right");
      const helpP = document.createElement("p");
      helpP.classList.add("help");

      if (isValidEmail(emailInput.value)) {
        emailInput.classList.add("is-success");
        iconSpan.innerHTML = '<i class="fas fa-check"></i>';
        helpP.classList.add("is-success")
        helpP.innerHTML = 'This email is valid.';
      } else {
        emailInput.classList.add("is-danger");
        iconSpan.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
        helpP.classList.add("is-danger")
        helpP.innerHTML = 'This email is invalid.';
      }

      // Append the icon span below the email input
      emailControl.appendChild(iconSpan);

      // Append the help paragraph to the email field
      emailField.appendChild(helpP);

    });
  });
</script>

<script>
  document.querySelector(".button.is-link").addEventListener("click", async function (e) {
    e.preventDefault();

    var error = false;

    // Add is-loading to the button when clicked
    const button = e.target;
    button.classList.add("is-loading");

    // Targets the top of the second column
    const notificationContainer = document.querySelector(".contact .column:nth-child(2)");
    // Clear all existing notifications
    const existingNotifications = notificationContainer.querySelectorAll(".notification");
    existingNotifications.forEach(notification => {
      notification.remove();
    });

    await new Promise((resolve) => setTimeout(resolve, 1000));

    const name = document.querySelector("input[placeholder='Name']").value;
    const email = document.querySelector("input[placeholder='Email']").value;
    const message = document.querySelector("textarea[placeholder='Message']").value;

    // Highlight empty fields with is-danger class
    const nameInput = document.querySelector("input[placeholder='Name']");
    const emailInput = document.querySelector("input[placeholder='Email']");
    const messageInput = document.querySelector("textarea[placeholder='Message']");

    // Find closest fields to the inputs
    const nameField = nameInput.closest(".field");
    const emailField = emailInput.closest(".field");
    const messageField = messageInput.closest(".field");

    // Ensure no duplicate help messages
    if (nameField.querySelector(".help.is-danger")) {
      nameField.querySelector(".help.is-danger").remove();
    }
    if (emailField.querySelector(".help.is-danger")) {
      emailField.querySelector(".help.is-danger").remove();
    }
    if (messageField.querySelector(".help.is-danger")) {
      messageField.querySelector(".help.is-danger").remove();
    }

    // Helper function to add a notification
    const addNotification = (type, message) => {
      // Create a new notification
      const notification = document.createElement("div");
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <button class="delete"></button>
        ${message}
      `;

      // Add event listener to close button
      notification.querySelector(".delete").addEventListener("click", () => {
        notification.remove();
      });

      // Insert the notification at the top of the second column
      notificationContainer.prepend(notification);
    };

    // Function to validate an email using regex
    const isValidEmail = (email) => {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    };

    if (!isValidEmail(email)) {
      const emailHelp = document.createElement("p");
      emailHelp.classList.add("help", "is-danger", "none");
      emailHelp.innerHTML = "This email is invalid.";

      emailInput.classList.add("is-danger");
      emailField.appendChild(emailHelp);

      addNotification("is-danger", "Failed to Send Email. Email is invalid. Email addresses should follow username@domain.com.");
      button.classList.remove("is-loading");
      error = true;
    }

    if (!name || !email || !message) {
      // Create help texts below inputs
      const nameHelp = document.createElement("p");
      nameHelp.classList.add("help", "is-danger");
      nameHelp.innerHTML = "Name is required.";

      const emailHelp = document.createElement("p");
      emailHelp.classList.add("help", "is-danger", "none");
      emailHelp.innerHTML = "Email is required.";

      const messageHelp = document.createElement("p");
      messageHelp.classList.add("help", "is-danger");
      messageHelp.innerHTML = "Message is required.";

      // Add validation
      if (!name) {
        nameInput.classList.add("is-danger");
        nameField.appendChild(nameHelp);

        // Remove the is-danger class and help text once the user starts typing
        nameInput.addEventListener("input", () => {
          if (nameInput.value.trim() !== "") {
            nameInput.classList.remove("is-danger");
            nameHelp.remove();
          }
        });
      }
      if (!email) {
        emailInput.classList.add("is-danger");
        emailField.appendChild(emailHelp);

        // Remove the is-danger class and help text once the user starts typing
        emailInput.addEventListener("input", () => {
          if (emailInput.value.trim() !== "") {
            emailHelp.remove();
          }
        });
      }
      if (!message) {
        messageInput.classList.add("is-danger");
        messageField.appendChild(messageHelp);

        // Remove the is-danger class and help text once the user starts typing
        messageInput.addEventListener("input", () => {
          if (messageInput.value.trim() !== "") {
            messageInput.classList.remove("is-danger");
            messageHelp.remove();
          }
        });
      }

      // Show notification and remove loading button
      addNotification("is-danger", "Failed to Send Email. Please fill out all fields.");
      button.classList.remove("is-loading");
      error = true;
    }

    if (error) {
      return;
    }

    try {
      const response = await fetch("/send_email", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, message }),
      });

      const result = await response.json();
      if (response.ok) {
        addNotification("is-success", result.message);
      } else {
        addNotification("is-danger", result.message);
      }
    } catch (error) {
      addNotification("is-danger", "Failed to send email. Please try again later.");
      console.error(error);
    } finally {
      button.classList.remove("is-loading");
    }
  });
</script>
